<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>United Transindo Admin Dashboard</title>
    <link rel="icon" type="image/x-icon" href="/images/icons/Logo United Transindo.ico">
	<!-- core:css -->
	<link rel="stylesheet" href="/vendors/core/core.css">
	<!-- endinject -->
    <!-- plugin css for this page -->
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- Bootstrap Msg CSS -->
    <link rel="stylesheet" href="/vendors/sweetalert2/sweetalert2.min.css">
	<!-- end plugin css for this page -->
	<!-- inject:css -->
	<link rel="stylesheet" href="/fonts/feather-font/css/iconfont.css">
	<link rel="stylesheet" href="/vendors/flag-icon-css/css/flag-icon.min.css">
	<!-- endinject -->
    <!-- Layout styles -->  
	<link rel="stylesheet" href="/css/demo_1/style.css">
    <!-- End layout styles -->
    <!-- <link rel="shortcut icon" href="/images/favicon.png" /> -->
    <link rel="icon" type="image/x-icon" href="./images/icons/Logo United Transindo.ico">
    <style>
        .main-wrapper > .page-wrapper.full-page {
            background-image: url("/images/united-transindo-background.jpg");
            background-position: center center;
            background-repeat: no-repeat;
            background-size: cover;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-attachment: fixed;
        }
        .auth-page {
            .auth-left-wrapper {
                background-image: url("/images/united-transindo-towing.jpg");
            }
        }
        input.form-control {
            border-color: #000;
            border-radius: 4px;
        }
    </style>
</head>
<body>
	<div class="main-wrapper">
		<div class="page-wrapper full-page">
			<div class="page-content d-flex align-items-center justify-content-center">

				<div class="row w-100 mx-0 auth-page">
					<div class="col-md-8 col-xl-6 mx-auto">
						<div class="card" style="border-color: rgba(160,156,153,255);">
							<div class="row">
                                <div class="col-md-4 pr-md-0">
                                    <div class="auth-left-wrapper">

                                    </div>
                                </div>
                                <div class="col-md-8 pl-md-0">
                                    <div class="auth-form-wrapper px-4 py-5">
                                        <p class="bs">Back to <a href="/">Home</a></p><br />
                                        <!-- <a href="#" class="noble-ui-logo d-block mb-2">Noble<span>UI</span></a> -->
                                        <a href="#" class="noble-ui-logo d-block mb-2" style="cursor: pointer">
                                            <img
                                                src="/images/icons/Logo United Transindo.png"
                                                alt=""
                                                width="30"
                                                height="30"
                                            />
                                            <text
                                                for=""
                                                style="margin: 0; font-size: 17px; text-wrap: nowrap; cursor: pointer;"
                                            >United Transindo</text>
                                        </a>
                                        <h5 class="text-muted font-weight-normal mb-4">Welcome back! Log in to your account</h5>
                                        <div id="alert-message" class="alert alert-danger fade show" role="alert" style="display: none; text-align: center;">
                                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <form method="post" action="/sign-in" id="sign-in-form" class="forms-sample" name="sign-in-form">
                                            <div class="form-group">
                                                <label for="email">Email Address</label>
                                                <input type="email" class="form-control" id="email" name="email" placeholder="Email" autocomplete="email">
                                                <span id="email-error" class="error text-danger"></span>
                                            </div>
                                            <div class="form-group">
                                                <label for="password">Password</label>
                                                <input type="password" class="form-control" id="password" name="password" autocomplete="current-password" placeholder="Password">
                                                <span id="password-error" class="error text-danger"></span>
                                            </div>
                                            <div class="form-check form-check-flat form-check-primary">
                                                <label class="form-check-label">
                                                <input id="remember" type="checkbox" name="remember" class="form-check-input">
                                                Remember me
                                                </label>
                                            </div>
                                            <div class="mt-3">
                                                <button type="submit" class="btn btn-primary">Sign In</button>
                                                <!-- <a href="../../dashboard-one.html" class="btn btn-primary mr-2 mb-2 mb-md-0 text-white">Login</a> -->
                                                <!-- <button type="button" class="btn btn-outline-primary btn-icon-text mb-2 mb-md-0">
                                                <i class="btn-icon-prepend" data-feather="twitter"></i>
                                                Login with twitter
                                                </button> -->
                                            </div><br />
                                            <!-- <a href="/register" class="d-block mt-3 text-muted">Not a user? Sign up</a> -->
                                            <p class="fs">Forgot <a href="#">Email</a> or <a href="">Password</a> ? </p>
                                            <p class="ss">Don't have an account ? <a href="/sign-up">Sign Up</a></p>
                                        </form>
                                        <!-- <% if(typeof message != 'undefined' && message) { %>
                                            <style>
                                                .form-input {
                                                    top: 20px;
                                                }
                                
                                                div.alert.alert-success {
                                                    top: inherit;
                                                }
                                            </style>
                                            <div class="alert alert-success">
                                                <%= message %>
                                            </div>
                                        <% } %> -->
                                    </div>
                                </div>
                            </div>
						</div>
					</div>
				</div>

			</div>
		</div>
	</div>

	<!-- core:js -->
	<script src="/vendors/core/core.js"></script>
	<!-- endinject -->
    <!-- plugin js for this page -->
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.4.0.min.js"></script>
    <script src="/vendors/jquery-ui/jquery-ui.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="/vendors/sweetalert2/sweetalert2.min.js"></script>
	<!-- end plugin js for this page -->
	<!-- inject:js -->
	<script src="/vendors/feather-icons/feather.min.js"></script>
	<script src="/js/template.js"></script>
	<!-- endinject -->
    <!-- custom js for this page -->
	<!-- end custom js for this page -->

    <script>
        $(document).ready(function() {
            $("#email").on("input", (event) => {
                $("#alert-message").text("").hide();
                $("#email-error").text("")
            });

            $("#password").on("input", (event) => {
                $("#alert-message").text("").hide();
                $("#password-error").text("")
            });

            const form = document.forms.namedItem("sign-in-form");
            
            form.addEventListener("submit", async (event) => {
                event.preventDefault();

                // reset errors
                $("#alert-message").text("").hide();
                $("#email-error").text("")
                $("#password-error").text("")

                // get values
                const email = form.email.value;
                const password = form.password.value;

                try {
                    const response = await fetch("/sign-in", {
                        method: "POST",
                        body: JSON.stringify({ email, password }),
                        headers: {'Content-Type': 'application/json'}
                    });
                    console.log("response of sign in = ", response);

                    const result = await response.json();

                    console.log("result of sign in = ", result);


                    if (result.errors) {
                        console.log('error: ', response.status, response.statusText);
                        console.error('Promise resolved but HTTP status failed');

                        const { message, email, password } = result.errors
                        if (message) {
                            $("#alert-message").text(message).show();
                        }
                        if (email) {
                            $("#email-error").text(email)
                        }
                        if (password) {
                            $("#password-error").text(password)
                        }
                        const DangerToast = Swal.mixin({
                            toast: true,
                            position: 'bottom-start',
                            showConfirmButton: false,
                            timer: 5000,
                            timerProgressBar: true,
                        });
                            
                        return DangerToast.fire({
                            icon: 'error',
                            html: `<label>Sign In Failed</label>`,
                        });
                    }
                    
                    if (result.user) {
                        console.log('success: ', response.status, response.statusText);
                        console.log('Promise resolved and HTTP status is successful');

                        const SuccessToast = Swal.mixin({
                            toast: true,
                            position: 'bottom-start',
                            showConfirmButton: false,
                            timer: 5000,
                            timerProgressBar: true,
                        });
                            
                        SuccessToast.fire({
                            icon: 'success',
                            html: `<label>Sign In Successfully</label>`,
                        });

                        setTimeout(() => { location.replace("/dashboard"); }, 1000);
                    }
                } catch (err) {
                    console.error(err)
                    
                    const ErrorToast = Swal.mixin({
                        toast: true,
                        position: 'bottom-start',
                        showConfirmButton: false,
                        timer: 5000,
                        timerProgressBar: true,
                    });
                    
                    return ErrorToast.fire({
                        icon: 'error',
                        html: `<label>There is something wrong when submit sign in form</label>`,
                    });
                }
            });
        });
    </script>
</body>
</html>