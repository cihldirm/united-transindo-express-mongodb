<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <meta http-equiv="X-UA-Compatible" content="ie=edge" /> -->
    <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="initial-scale=1.0, target-densitydpi=device-dpi" /><!-- this is for mobile (Android) Chrome -->
    <meta name="viewport" content="initial-scale=1.0, width=device-height"><!--  mobile Safari, FireFox, Opera Mobile  -->
    <script type="text/javascript" src="/vendors/jSignature/libs/modernizr.js"></script>
    <title>United Transindo Admin Dashboard</title>
    <link rel="icon" type="image/x-icon" href="/images/icons/Logo United Transindo.ico">
    <!-- core:css -->
    <link rel="stylesheet" href="/vendors/core/core.css" />
    <!-- endinject -->
    <!-- plugin css for this page -->
    <!-- Bootstrap CSS -->
    <!-- <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Msg CSS -->
    <!-- <link rel="stylesheet" href="/css/bootstrap-msg.css"> -->
    <!-- Font Awesome 4 -->
    <link rel="stylesheet" href="/vendors/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/vendors/select2/select2.min.css">
    <link rel="stylesheet" href="/vendors/bootstrap-datepicker/bootstrap-datepicker.min.css">
    <link
      rel="stylesheet"
      href="/vendors/sweetalert2/sweetalert2.min.css"
    />
    <!-- end plugin css for this page -->
    <!-- inject:css -->
    <link
      rel="stylesheet"
      href="/fonts/feather-font/css/iconfont.css"
    />
    <link
      rel="stylesheet"
      href="/vendors/flag-icon-css/css/flag-icon.min.css"
    />
    <!-- endinject -->
    <!-- Layout styles -->
    <link rel="stylesheet" href="/css/demo_1/style.css" />
    
    <!--[if lt IE 9]>
    <script type="text/javascript" src="/vendors/jSignature/libs/flashcanvas.js"></script>
    <![endif]-->
    <style>
      .page-content {
        padding-bottom: 0 !important;
        display: grid;
      }
      .spinner-border {
        position: absolute;
        top: calc(50% + 30px);
        left: calc(50% + 120px);
      }
      #myList .list-group-item-action:focus {
        border: 1px solid rgba(0, 0, 0, 0.125);
        opacity: 0.5;
      }
      .pager .pagination li.page-item.disabled {
        .page-link {
          /* background-color: #e9ecef; */
          color: rgba(33,37,41,0.75);
          background-color: #adb5bd;
        }
      }

      /* .alert-div > div.alert.alert-danger{
        font-weight: bold;
        text-align: center;
        width: fit-content;
        margin: auto;
        transition: 1s;
      }
      div.alert{
        display: flex;
        font-weight: bold;
        width: fit-content;
        margin: auto;
        transition: 1s;
        label{
          margin: 0;
        }
        button.close{
          padding: 0;
          top: unset;
          right: 1.25rem;
        }
      }
      .alert.show{
        animation: show_slide 1.2s ease forwards;
      }

      .alert.hide{
        animation: hide_slide 1.2s ease forwards;
      }

      @keyframes show_slide{
        0%{
          transform: translateX(100%);
        }
        45%{
          transform: translateX(-5%);
          opacity: 0.4;
        }
        75%{
          transform: translateX(2%);
          opacity: 0.8;
        }
        100%{
          transform: translateX(-2%);
          opacity: 1;
        }
      }

      @keyframes hide_slide{
        0%{
          opacity: 1;
          transform: translateX(0%);
        }
        100%{
          opacity: 0;
          transform: translateX(100%);
        }
      } */
    </style>
    <!-- End layout styles -->
    <link
      rel="shortcut icon"
      href="/images/icons/Logo United Transindo.png"
    />
  </head>
  <body>
    <div class="main-wrapper">
      <!-- partial:partials/_sidebar.html -->
      <%- include('./sidebar.ejs') %>
      <!-- partial -->

      <div class="page-wrapper">
        <!-- partial:partials/_navbar.html -->
        <%- include('./navbar.ejs') %>
        <!-- partial -->

        <div class="page-content">
        
          <nav class="page-breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="#">Marketing</a></li>
              <li class="breadcrumb-item active" aria-current="page">
                Waitlist Approve Job Order
              </li>
            </ol>
          </nav>

          <div class="spinner-border" role="status">
            <span class="sr-only">Loading...</span>
          </div>

          <!-- <div class="list-group">
            <a href="#" class="list-group-item list-group-item-action active" aria-current="true">
              <div class="d-flex w-100 justify-content-between">
                <h5 class="mb-1">List group item heading</h5>
                <small>3 days ago</small>
              </div>
              <p class="mb-1">Some placeholder content in a paragraph.</p>
              <small>And some small print.</small>
            </a>
            <a href="#" class="list-group-item list-group-item-action">
              <div class="d-flex w-100 justify-content-between">
                <h5 class="mb-1">List group item heading</h5>
                <small class="text-muted">3 days ago</small>
              </div>
              <p class="mb-1">Some placeholder content in a paragraph.</p>
              <small class="text-muted">And some muted small print.</small>
            </a>
            <a href="#" class="list-group-item list-group-item-action">
              <div class="d-flex w-100 justify-content-between">
                <h5 class="mb-1">List group item heading</h5>
                <small class="text-muted">3 days ago</small>
              </div>
              <p class="mb-1">Some placeholder content in a paragraph.</p>
              <small class="text-muted">And some muted small print.</small>
            </a>
          </div>

          <div id="waitlist-approve" class="row">
            <div class="col-12">
              <div class="list-group" id="list-tab" role="tablist">
                <a class="list-group-item list-group-item-action" id="list-home-list" data-bs-toggle="list" href="#list-home" role="tab" aria-controls="list-home">Home</a>
                <a class="list-group-item list-group-item-action" id="list-profile-list" data-bs-toggle="list" href="#list-profile" role="tab" aria-controls="list-profile">Profile</a>
                <a class="list-group-item list-group-item-action" id="list-messages-list" data-bs-toggle="list" href="#list-messages" role="tab" aria-controls="list-messages">Messages</a>
                <a class="list-group-item list-group-item-action" id="list-settings-list" data-bs-toggle="list" href="#list-settings" role="tab" aria-controls="list-settings">Settings</a>
              </div>
            </div>
            <div class="col-8">
              <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="list-home" role="tabpanel" aria-labelledby="list-home-list">this is home</div>
                <div class="tab-pane fade" id="list-profile" role="tabpanel" aria-labelledby="list-profile-list">profile this is </div>
                <div class="tab-pane fade" id="list-messages" role="tabpanel" aria-labelledby="list-messages-list">this message is </div>
                <div class="tab-pane fade" id="list-settings" role="tabpanel" aria-labelledby="list-settings-list">this settings is </div>
              </div>
            </div>
          </div> -->

          <div id="waitlist-content" style="display: none;">
            <!-- <div class="col-12"> -->
              <h3>Waitlist Approve Job Order</h3>
              <!-- <div class="panel panel-default">
                <div class="panel-heading">Panel heading</div> -->
                <div id="myList" class="list-group mt-3"></div>

                <div class="pager mt-5">
                  <!-- <span class="previous"><a href="" onclick="prevPage(); return false;">«</a></span>
                  <span class="next"><a href="" onclick="nextPage(); return false;">»</a></span> -->

                  <!-- <ul class="pagination pagination-rounded pagination-sm justify-content-end">
                    <li class="page-item disabled">
                      <a class="page-link" href="" onclick="prevPage(); return false;" tabindex="-1" aria-disabled="true">«</a>
                    </li>
                    <li class="page-item"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item">
                      <a class="page-link" href="" onclick="nextPage(); return false;">»</a>
                    </li>
                  </ul> -->
                  <ul class="pagination pagination-rounded pagination-sm justify-content-end"></ul>
                </div>

                <!-- <nav id="pag_nav">
                  <ul class="pagination">
                  </ul>
                </nav> -->


              <!-- </div> -->
            <!-- </div> -->
          </div>

        </div>

        <!-- partial:partials/_footer.html -->
        <%- include('./footer.ejs') %>
        <!-- partial -->
      </div>
    </div>

    <!-- core:js -->
    <script src="/vendors/core/core.js"></script>
    <!-- endinject -->
    <!-- plugin js for this page -->
    <!-- jQuery -->
    <!-- <script src="/vendors/jSignature/libs/jquery.js"></script> -->
    <script src="https://code.jquery.com/jquery-3.4.0.min.js"></script>
    <script src="/vendors/jquery.autosize.input/jquery.autosize.input.js"></script>
    <!-- Bootstrap JS -->
    <!-- <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Bootsrap Msg Js -->
    <!-- <script src="/js/bootstrap-msg.js"></script> -->
    <script src="/vendors/chartjs/Chart.min.js"></script>
    <script src="/vendors/jquery.flot/jquery.flot.js"></script>
    <script src="/vendors/jquery.flot/jquery.flot.resize.js"></script>
    <script src="/vendors/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
    <!-- <script src="https://github.com/jquery/jquery-ui/blob/main/ui/i18n/datepicker-id.js" type='text/javascript'></script> -->
    <script src="/vendors/apexcharts/apexcharts.min.js"></script>
    <script src="/vendors/progressbar.js/progressbar.min.js"></script>
    <script src="/vendors/select2/select2.min.js"></script>
    <script src="/vendors/sweetalert2/sweetalert2.min.js"></script>
    <script src="/vendors/promise-polyfill/polyfill.min.js"></script>
    <!-- Optional:  polyfill for ES6 Promises for IE11 and Android browser -->
    <script src="/vendors/moment/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.27.0/locale/id.min.js" integrity="sha512-he8U4ic6kf3kustvJfiERUpojM8barHoz0WYpAUDWQVn61efpm3aVAD8RWL8OloaDDzMZ1gZiubF9OSdYBqHfQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="/vendors/tempusdominus-bootstrap-4/tempusdominus-bootstrap-4.js"></script>
    <script src="/vendors/inputmask/jquery.inputmask.min.js"></script>
    <script src="/vendors/jquery-validation/jquery.validate.min.js"></script>
    <!-- <script src="/vendors/jSignature/src/jSignature.js"></script>
    <script src="/vendors/jSignature/src/plugins/jSignature.CompressorBase30.js"></script>
    <script src="/vendors/jSignature/src/plugins/jSignature.CompressorSVG.js"></script>
    <script src="/vendors/jSignature/src/plugins/jSignature.UndoButton.js"></script> 
    <script src="/vendors/jSignature/src/plugins/signhere/jSignature.SignHere.js"></script> 
    <script src="https://willowsystems.github.io/jSignature/js/libs/jSignature.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
    <!-- end plugin js for this page -->
    <!-- inject:js -->
    <script src="/vendors/feather-icons/feather.min.js"></script>
    <script src="/js/template.js"></script>
    <!-- endinject -->
    <!-- custom js for this page -->
    <!-- <script src="/js/dashboard.js"></script> -->
    <!-- <script src="/js/datepicker-id.js" charset="UTF-8"></script> -->
    <!-- <script src="/js/datepicker.js"></script> -->
    <!-- <script src="/js/timepicker.js"></script> -->
    <!-- end custom js for this page -->

    <script>
      var waitlistJobOrder = <%- JSON.stringify(waitlistJobOrder) %>;
      console.log("waitlistJobOrder is = ", JSON.stringify(waitlistJobOrder, null, '\t'));

        var pager = {};
        pager.items = waitlistJobOrder;
        pager.itemsPerPage = 3;
        pager.currentPage = 0;
        pagerInit(pager);

        function bindList() {
            let pgItems = pager.pagedItems[pager.currentPage];
            $('.pager .pagination li').removeClass('disabled');
            // $(this).not('.prev,.next').addClass('active');
            // $('li.prev').next().addClass('active');
            if (pager.currentPage === 0) {
              $('li.prev').addClass('disabled');
            } else if (pager.currentPage + 1 === pager.pagedItems.length) {
              $('li.next').addClass('disabled');
            }
            
            $("#myList").empty();
            for(let i = 0, city; i < pgItems.length; i++){
              switch (pgItems[i].city_code) {
                  case "01":
                      city = "Sidoarjo";
                      break;
                  case "02":
                      city = "Cikarang";
                      break;
                  case "03":
                      city = "Jakarta";
                      break;
                  case "04":
                      city = "Makassar";
                      break;
              }

              let option = `
                <a href="" class="list-group-item list-group-item-action">
                  <div class="d-flex w-100 justify-content-between">
                    <h5 id="no_jo" class="mb-1">Job Order No. ${pgItems[i].city_code + String(moment(new Date(pgItems[i].tgl_wkt_dibuat)).format('YY')) + pgItems[i].no_joj}</h5>
                    <small class="text-muted">${city}, tanggal ${moment(pgItems[i].tgl_wkt_dibuat).format('DD MMMM YYYY')} jam ${moment(pgItems[i].tgl_wkt_dibuat).format('HH:mm')}</small>
                  </div>
                  <p class="mb-1">Dari ${pgItems[i].nama_pengirim} kepada ${pgItems[i].nama_penerima}</p>
                  <small class="text-muted">Pengambilan Unit pada hari ${pgItems[i].hr_tgl_ambil.split(" / ")[0]} tanggal ${pgItems[i].hr_tgl_ambil.split(" / ")[1]}</small>
                </a>
              `;

              // console.log("option is = ", option);

              $("#myList").append(option);
            }
        }

        // function prevPage(){
        //     pager.prevPage();
        //     bindList();
        // }

        // function nextPage(){
        //     pager.nextPage();
        //     bindList();
        // }

        function pagerInit(p) {
            p.pagedItems = [];
            p.prevPage = function () {
                if (p.currentPage > 0) {
                  $('li.active').removeClass('active').prev().addClass('active');
                    p.currentPage--;
                }
            };
            p.nextPage = function () {
                if (p.currentPage < p.pagedItems.length - 1) {
                  $('li.active').removeClass('active').next().addClass('active');
                    p.currentPage++;
                }
            };
            init = function () {
                $(".pager ul.pagination").empty();
                
                // $(".pager ul.pagination").append('<li class=prev><a href="" aria-label=Previous><span aria-hidden=true>&laquo;</span></a></li>');
                // JSON.stringify(p.pagedItems, null, '\t')
                $(".pager ul.pagination").append(`
                  <li class="page-item prev disabled">
                    <a class="page-link" href="" tabindex="-1" aria-disabled="true">«</a>
                  </li>
                `);
                for (let i = 0; i < p.items.length; i++) {
                  // console.log("Math.floor(i / p.itemsPerPage) = ", Math.floor(i / p.itemsPerPage));
                  // console.log("p.items[i] = ", p.items[i]);
                  if (i % p.itemsPerPage === 0) {
                      p.pagedItems[Math.floor(i / p.itemsPerPage)] = [p.items[i]];
                  } else {
                      p.pagedItems[Math.floor(i / p.itemsPerPage)].push(p.items[i]);
                  }
                  console.log("p.pagedItems = ", JSON.stringify(p.pagedItems, null, '\t'));
                }
                console.log("p.pagedItems final result = ", JSON.stringify(p.pagedItems, null, '\t'));
                for (let index = 1; index <= p.pagedItems.length; index++) {
                  $(".pager ul.pagination").append(`
                    <li class="page-item"><a class="page-link" href="">${index}</a></li>
                  `);
                }
                $(".pager ul.pagination").append(`
                  <li class="page-item next">
                    <a class="page-link" href="">»</a>
                  </li>
                `);
                $('li.prev').next().addClass('active');
            };
            init();
        }

        $(document).ready(function() {
            

            // for (let index = 0; index < waitlistJobOrder.length; index++) {
            //     console.log("index is = ", index);
            //     console.log("waitlistJobOrder is = ", waitlistJobOrder[index]);
            // }

            const loadData = async () => {
              bindList();
              console.log("pager after init ready = ", pager);
            };

            loadData();

            $(".spinner-border").hide();

            $("#waitlist-content").show();

            $('#myList').on('click', '.list-group-item-action', async function(event) {
              event.preventDefault();
              let no_jo = waitlistJobOrder[pager.currentPage * pager.itemsPerPage + $(this).index()].no_joj;
              // console.log("no_jo is = ", no_jo);
              // console.log($(this).data('wpurl'));
              // event.originalEvent.currentTarget.href = `/job-order/${no_jo}`;
              // console.log(event.originalEvent.currentTarget.href);
              if (user.role === "Marketing") {
                location.replace(`/job-order/${no_jo}`);
              } else if (user.role === "Operational") {
                location.replace(`/approve-job-order/${no_jo}`);
              }
              // return await fetch(`/job-order/${no_jo}`, {
              //       method: "GET",
              //       headers: {
              //         "Content-Type": "application/json",
              //       },
              //     });
              // return false;
              // event.preventDefault();
              // return;
            });

            $('.pager .pagination').on('click', 'li:not(.prev):not(.next)', function() {
              $('.pager .pagination li').removeClass('active');
              $(this).not('.prev,.next').addClass('active');
              pager.currentPage = Number($(this).text()) - 1;
              bindList();
              return false;
            });

            $('.pager .pagination').on('click', 'li.prev', function() {
              // $('li.active').removeClass('active').prev().addClass('active');
              pager.prevPage();
              bindList();
              return false;
            });

            $('.pager .pagination').on('click', 'li.next', function() {
              // $('li.active').removeClass('active').next().addClass('active');
              pager.nextPage();
              bindList();
              return false;
            });


        });
    </script>
  </body>
</html>
