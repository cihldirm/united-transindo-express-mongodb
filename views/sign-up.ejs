<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>United Transindo Admin Dashboard</title>
    <link rel="icon" type="image/x-icon" href="/images/icons/Logo United Transindo.ico">
	<!-- core:css -->
	<link rel="stylesheet" href="/vendors/core/core.css">
	<!-- endinject -->
    <!-- plugin css for this page -->
     <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- Bootstrap Msg CSS -->
    <link rel="stylesheet" href="/vendors/sweetalert2/sweetalert2.min.css">
	<!-- end plugin css for this page -->
	<!-- inject:css -->
	<link rel="stylesheet" href="/fonts/feather-font/css/iconfont.css">
	<link rel="stylesheet" href="/vendors/flag-icon-css/css/flag-icon.min.css">
	<!-- endinject -->
    <!-- Layout styles -->  
	<link rel="stylesheet" href="/css/demo_1/style.css">
    <!-- End layout styles -->
    <link rel="shortcut icon" href="/images/favicon.png" />
    <style>
        .main-wrapper > .page-wrapper.full-page {
            background-image: url("/images/united-transindo-background.jpg");
            background-position: center center;
            background-repeat: no-repeat;
            background-size: cover;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-attachment: fixed;
        }
        .auth-page {
            .auth-left-wrapper {
                background-image: url("/images/united-transindo-car-carrier.jpg");
                background-position: 20%;
            }
        }
        input.form-control, select.form-control {
            border-color: #000;
            border-radius: 4px;
            color : #495057;
        }
    </style>
</head>
<body>
	<div class="main-wrapper">
		<div class="page-wrapper full-page">
			<div class="page-content d-flex align-items-center justify-content-center">

				<div class="row w-100 mx-0 auth-page">
					<div class="col-md-8 col-xl-6 mx-auto">
						<div class="card" style="border-color: rgba(160,156,153,255);">
							<div class="row">
                                <div class="col-md-4 pr-md-0">
                                    <div class="auth-left-wrapper">

                                    </div>
                                </div>
                                <div class="col-md-8 pl-md-0">
                                    <div class="auth-form-wrapper px-4 py-5">
                                        <p class="bs">Back to <a href="/">Home</a></p><br />
                                        <a href="#" class="noble-ui-logo d-block mb-2" style="cursor: pointer">
                                            <img
                                                src="/images/icons/Logo United Transindo.png"
                                                alt=""
                                                width="30"
                                                height="30"
                                            />
                                            <label
                                                for=""
                                                style="margin: 0; font-size: 17px; text-wrap: nowrap; cursor: pointer;"
                                            >United Transindo</label>
                                        </a>
                                        <h5 class="text-muted font-weight-normal mb-4">Create a free account</h5>
                                        <form method="post" action="/sign-up" id="sign-up-form" class="forms-sample" name="sign-up-form">
                                            <div class="form-group">
                                                <label for="username">Username</label>
                                                <input type="text" class="form-control" id="username" name="username" autocomplete="Username" placeholder="Username">
                                                <span id="username-error" class="error text-danger"></span>
                                            </div>
                                            <div class="form-group">
                                                <label for="name">Name</label>
                                                <input type="text" class="form-control" id="name" name="name" autocomplete="Name" placeholder="Name">
                                                <span id="name-error" class="error text-danger"></span>
                                            </div>
                                            <div class="form-group">
                                                <label for="email">Email Address</label>
                                                <input type="email" class="form-control" id="email" name="email" placeholder="Email">
                                                <span id="email-error" class="error text-danger"></span>
                                            </div>
                                            <div class="form-group">
                                                <label for="role">Role</label>
                                                <select name="role" id="role" class="form-control">
                                                    <option value="" selected disabled>Select an Option</option>
                                                    <option value="Marketing">Marketing</option>
                                                    <option value="Operational">Operational</option>
                                                    <option value="Finance">Finance</option>
                                                </select>
                                                <span id="role-error" class="error text-danger"></span>
                                            </div>
                                            <div class="form-group">
                                                <label for="location">Location</label>
                                                <select name="location" id="location" class="form-control">
                                                    <option value="" selected disabled>Select an Option</option>
                                                    <option value="Sidoarjo">UT Sidoarjo</option>
                                                    <option value="Cikarang">Pool Cikarang</option>
                                                    <option value="Jakarta">UT Jakarta</option>
                                                    <option value="Makassar">UT Makassar</option>
                                                </select>
                                                <span id="location-error" class="error text-danger"></span>
                                            </div>
                                            <div class="form-group">
                                                <label for="password">Password</label>
                                                <input type="password" class="form-control" id="password" name="password" autocomplete="current-password" placeholder="Password">
                                                <span id="password-error" class="error text-danger"></span>
                                            </div>
                                            <div class="form-group">
                                                <label for="confirm-password">Confirm Password</label>
                                                <input type="password" class="form-control" id="confirm-password" name="confirm_password" autocomplete="confirm-password" placeholder="Confirm Password">
                                                <span id="confirm-password-error" class="error text-danger"></span>
                                            </div>
                                            <div class="form-check form-check-flat form-check-primary">
                                                <label class="form-check-label">
                                                <input type="checkbox" class="form-check-input">
                                                Remember me
                                                </label>
                                            </div>
                                            <div class="mt-3">
                                                <!-- <a href="/sign-up" class="btn btn-primary mb-2 text-white">Sign Up</a> -->
                                                <button type="submit" class="btn btn-primary">Sign Up</button>
                                            </div><br />
                                            <p class="ss">Already a user? <a href="/sign-in">Sign In</a></p>
                                        </form>
                                    </div>
                                </div>
                            </div>
						</div>
					</div>
				</div>

			</div>
		</div>
	</div>

	<!-- core:js -->
	<script src="/vendors/core/core.js"></script>
	<!-- endinject -->
    <!-- plugin js for this page -->
     <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.4.0.min.js"></script>
    <script src="/vendors/jquery-ui/jquery-ui.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="/vendors/sweetalert2/sweetalert2.min.js"></script>
	<!-- end plugin js for this page -->
	<!-- inject:js -->
	<script src="/vendors/feather-icons/feather.min.js"></script>
	<script src="/js/template.js"></script>
	<!-- endinject -->
    <!-- custom js for this page -->
	<!-- end custom js for this page -->

    <script>
        $(document).ready(function() {
            $("#username").on("input", (event) => {
                $("#alert-message").text("").hide();
                $("#username-error").text("")
            });

            $("#name").on("input", (event) => {
                $("#alert-message").text("").hide();
                $("#name-error").text("")
            });

            $("#email").on("input", (event) => {
                $("#alert-message").text("").hide();
                $("#email-error").text("")
            });

            $("#role").on("change", (event) => {
                $("#alert-message").text("").hide();
                $("#role-error").text("")
            });

            $("#location").on("change", (event) => {
                $("#alert-message").text("").hide();
                $("#location-error").text("")
            });

            $("#password").on("input", (event) => {
                $("#alert-message").text("").hide();
                $("#password-error").text("")
            });

            $("#confirm-password").on("input", (event) => {
                $("#alert-message").text("").hide();
                $("#confirm-password-error").text("")
            });

            const form = document.forms.namedItem("sign-up-form");
            form.addEventListener("submit", async (event) => {
                event.preventDefault();

                // reset errors
                $("#alert-message").text("").hide();
                $("#username-error").text("")
                $("#name-error").text("")
                $("#email-error").text("")
                $("#role-error").text("")
                $("#location-error").text("")
                $("#password-error").text("")
                $("#confirm-password-error").text("")

                // get values
                const username = form.username.value;
                const name = form.name.value;
                const email = form.email.value;
                const role = form.role.value;
                const userLocation = form.location.value;
                const password = form.password.value;
                const confirm_password = form.confirm_password.value;

                console.log("username in sign up", username);
                console.log("name in sign up", name);
                console.log("email in sign up", email);
                console.log("role in sign up", role);
                console.log("location in sign up", userLocation);
                console.log("password in sign up", password);
                console.log("confirm_password in sign up", confirm_password);

                try {
                    const response = await fetch("/sign-up", {
                        method: "POST",
                        body: JSON.stringify({ 
                            username,
                            name,
                            email,
                            role,
                            userLocation,
                            password,
                            confirm_password
                        }),
                        headers: {
                            'Content-Type': 'application/json',
                            'accept': 'application/json',
                        }
                    });
                    console.log("response of sign up = ", response);

                    const result = await response.json();

                    console.log("result of sign up = ", result);


                    if (result.errors) {
                        console.log('error: ', response.status, response.statusText);
                        console.error('Promise resolved but HTTP status failed');

                        const { message, 
                            username,
                            name,
                            email,
                            role,
                            location,
                            password,
                            confirm_password } = result.errors
                        if (message) {
                            $("#alert-message").text(message).show();
                        }
                        if (username) {
                            $("#username-error").text(username)
                        }
                        if (name) {
                            $("#name-error").text(name)
                        }
                        if (email) {
                            $("#email-error").text(email)
                        }
                        if (role) {
                            $("#role-error").text(role)
                        }
                        if (location) {
                            $("#location-error").text(location)
                        }
                        if (password) {
                            $("#password-error").text(password)
                        }
                        if (confirm_password) {
                            $("#confirm-password-error").text(confirm_password)
                        }
                        const DangerToast = Swal.mixin({
                            toast: true,
                            position: 'bottom-start',
                            showConfirmButton: false,
                            timer: 5000,
                            timerProgressBar: true,
                        });
                            
                        return DangerToast.fire({
                            icon: 'error',
                            html: `<label>Sign Up Failed</label>`,
                        });
                    }
                    
                    if (result.user) {
                        console.log('success: ', response.status, response.statusText);
                        console.log('Promise resolved and HTTP status is successful');

                        const SuccessToast = Swal.mixin({
                            toast: true,
                            position: 'bottom-start',
                            showConfirmButton: false,
                            timer: 5000,
                            timerProgressBar: true,
                        });
                            
                        SuccessToast.fire({
                            icon: 'success',
                            html: `<label>Sign Up Successfully</label>`,
                        });

                        setTimeout(() => { location.replace("/dashboard"); }, 1000);
                    }
                } catch (err) {
                    console.error(err)
                    
                    const ErrorToast = Swal.mixin({
                        toast: true,
                        position: 'bottom-start',
                        showConfirmButton: false,
                        timer: 5000,
                        timerProgressBar: true,
                    });
                    
                    return ErrorToast.fire({
                        icon: 'error',
                        html: `<label>There is something wrong when submit sign up form</label>`,
                    });
                }
            });
        });
    </script>
</body>
</html>